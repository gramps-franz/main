<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combination Lock Game (Keyboard Enabled)</title>
    <style>
        /* Basic Page Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #34495e;
            color: #ecf0f1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
        }

        #app-container {
            background-color: #2c3e50;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        h1 {
            color: #f1c40f;
            margin-top: 0;
        }

        p.controls {
            color: #bdc3c7;
            font-size: 0.9rem;
        }

        /* Lock Dials */
        #lock-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 2rem 0;
        }

        .dial {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .digit-display {
            font-size: 3rem;
            font-weight: bold;
            background-color: #ecf0f1;
            color: #2c3e50;
            width: 60px;
            height: 70px;
            line-height: 70px;
            border-radius: 8px;
            margin: 5px 0;
            user-select: none;
            cursor: pointer;
            border: 2px solid transparent; /* Placeholder for active state */
            transition: all 0.2s ease-in-out;
        }
        
        /* NEW: Style for the active dial */
        .digit-display.active-dial {
            border: 2px solid #f1c40f;
            box-shadow: 0 0 15px #f1c40f;
        }


        .arrow {
            font-size: 1.5rem;
            cursor: pointer;
            border: none;
            background: none;
            color: #95a5a6;
            padding: 5px 15px;
            transition: color 0.2s, transform 0.1s;
        }

        .arrow:hover {
            color: #ecf0f1;
        }

        .arrow:active {
            transform: scale(0.9);
        }

        /* Buttons */
        #submit-btn, #reset-btn {
            font-size: 1.2rem;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #27ae60;
            color: white;
            font-weight: bold;
            transition: background-color 0.2s;
            margin-top: 1rem;
        }

        #submit-btn:hover {
            background-color: #2ecc71;
        }
        
        #reset-btn {
            background-color: #e74c3c;
        }

        #reset-btn:hover {
            background-color: #c0392b;
        }

        .hidden {
            display: none;
        }


        /* Message and History */
        #message-area {
            margin-top: 1.5rem;
            min-height: 25px;
            font-size: 1.2rem;
            font-style: italic;
            color: #f1c40f;
        }

        #history-container {
            margin-top: 1.5rem;
            background-color: #34495e;
            border-radius: 8px;
            padding: 10px 20px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

    <div id="app-container">
        <h1>Combination Lock</h1>
        <p>Find the secret 4-digit code. We'll only tell you how many digits are correct.</p>
        <p class="controls">
            <strong>Controls:</strong> Use <strong>0-9</strong>, <strong>Arrow Keys</strong>, and <strong>Enter</strong> to play.
        </p>

        <div id="lock-container">
            <!-- Dials will be generated by JavaScript -->
        </div>

        <button id="submit-btn">Test Combination</button>

        <div id="message-area">Enter your guess and press the button.</div>
        
        <div id="history-container">
            <h2>Guess History</h2>
            <ol id="history-list"></ol>
        </div>

        <button id="reset-btn" class="hidden">Play Again</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const lockContainer = document.getElementById('lock-container');
            const submitBtn = document.getElementById('submit-btn');
            const resetBtn = document.getElementById('reset-btn');
            const messageArea = document.getElementById('message-area');
            const historyList = document.getElementById('history-list');

            // --- Game State ---
            let secretCode = [];
            let currentGuess = [0, 0, 0, 0];
            let guessCount = 0;
            let gameWon = false;
            let activeDialIndex = 0; // NEW: Track the currently selected dial

            // --- Functions ---

            function createDials() {
                for (let i = 0; i < 4; i++) {
                    const dial = document.createElement('div');
                    dial.className = 'dial';
                    dial.innerHTML = `
                        <button class="arrow up" data-index="${i}">▲</button>
                        <div class="digit-display" data-index="${i}">${currentGuess[i]}</div>
                        <button class="arrow down" data-index="${i}">▼</button>
                    `;
                    lockContainer.appendChild(dial);
                }
            }
            
            // NEW: Helper to update a single dial's display
            function updateSingleDialDisplay(index) {
                const digitDisplay = document.querySelector(`.digit-display[data-index="${index}"]`);
                if (digitDisplay) {
                    digitDisplay.textContent = currentGuess[index];
                }
            }

            // NEW: Helper to update the visual for the active dial
            function updateActiveDialVisuals() {
                document.querySelectorAll('.digit-display').forEach((disp, index) => {
                    if (index === activeDialIndex) {
                        disp.classList.add('active-dial');
                    } else {
                        disp.classList.remove('active-dial');
                    }
                });
            }

            function handleDialChange(e) {
                if (gameWon) return;

                const target = e.target;
                
                // Handle clicks on arrows
                if (target.matches('.arrow')) {
                    const index = parseInt(target.dataset.index);
                    const isUp = target.classList.contains('up');
                    
                    if (isUp) {
                        currentGuess[index] = (currentGuess[index] + 1) % 10;
                    } else {
                        currentGuess[index] = (currentGuess[index] - 1 + 10) % 10;
                    }
                    updateSingleDialDisplay(index);
                }

                // NEW: Handle clicks on the digit display itself to set focus
                if (target.matches('.digit-display')) {
                    activeDialIndex = parseInt(target.dataset.index);
                    updateActiveDialVisuals();
                }
            }
            
            function compareGuess(guess) {
                let correctCount = 0;
                const tempSecret = [...secretCode];
                const tempGuess = [...guess];
                
                for (let i = 0; i < tempGuess.length; i++) {
                    const digit = tempGuess[i];
                    const foundIndex = tempSecret.indexOf(digit);
                    if (foundIndex > -1) {
                        correctCount++;
                        tempSecret.splice(foundIndex, 1);
                    }
                }
                return correctCount;
            }

            function updateHistory(guess, correctCount) {
                const li = document.createElement('li');
                li.textContent = `Guess #${guessCount}: [${guess.join(', ')}] - ${correctCount} correct`;
                if (correctCount === 4) {
                    li.classList.add('win');
                    li.textContent += ' - YOU WIN!';
                }
                historyList.prepend(li);
            }
            
            function handleSubmitGuess() {
                if (gameWon) return;
                guessCount++;
                const correctCount = compareGuess(currentGuess);
                updateHistory(currentGuess, correctCount);

                if (correctCount === 4) {
                    gameWon = true;
                    messageArea.textContent = `Congratulations! You cracked the code in ${guessCount} guesses.`;
                    messageArea.style.color = '#2ecc71';
                    submitBtn.classList.add('hidden');
                    resetBtn.classList.remove('hidden');
                    document.querySelector('.active-dial')?.classList.remove('active-dial');
                } else {
                    messageArea.textContent = `You have ${correctCount} correct number(s). Try again.`;
                    activeDialIndex = 0; // Reset focus to the first dial
                    updateActiveDialVisuals();
                }
            }

            function resetGame() {
                secretCode = Array.from({length: 4}, () => Math.floor(Math.random() * 10));
                // For testing, uncomment this line to see the code in the browser's console
                // console.log("Secret Code:", secretCode.join(''));

                currentGuess = [0, 0, 0, 0];
                guessCount = 0;
                gameWon = false;
                activeDialIndex = 0; // Reset focus to the first dial

                historyList.innerHTML = '';
                messageArea.textContent = 'Enter your guess and press the button.';
                messageArea.style.color = '#f1c40f';
                
                document.querySelectorAll('.digit-display').forEach((display, index) => {
                    display.textContent = currentGuess[index];
                });

                submitBtn.classList.remove('hidden');
                resetBtn.classList.add('hidden');
                updateActiveDialVisuals(); // Set initial active dial visual
            }

            // --- NEW: Keyboard Input Handler ---
            function handleKeyPress(e) {
                if (gameWon) return;

                // Handle number keys 0-9
                if (e.key >= '0' && e.key <= '9') {
                    currentGuess[activeDialIndex] = parseInt(e.key);
                    updateSingleDialDisplay(activeDialIndex);
                    // Move to next dial, wrapping around
                    activeDialIndex = (activeDialIndex + 1) % 4;
                    updateActiveDialVisuals();
                }

                // Handle other control keys
                switch (e.key) {
                    case 'Enter':
                        handleSubmitGuess();
                        break;
                    case 'ArrowRight':
                        activeDialIndex = (activeDialIndex + 1) % 4;
                        updateActiveDialVisuals();
                        break;
                    case 'ArrowLeft':
                        activeDialIndex = (activeDialIndex - 1 + 4) % 4;
                        updateActiveDialVisuals();
                        break;
                    case 'ArrowUp':
                        e.preventDefault(); // Prevent page scrolling
                        currentGuess[activeDialIndex] = (currentGuess[activeDialIndex] + 1) % 10;
                        updateSingleDialDisplay(activeDialIndex);
                        break;
                    case 'ArrowDown':
                        e.preventDefault(); // Prevent page scrolling
                        currentGuess[activeDialIndex] = (currentGuess[activeDialIndex] - 1 + 10) % 10;
                        updateSingleDialDisplay(activeDialIndex);
                        break;
                }
            }

            // --- Event Listeners ---
            lockContainer.addEventListener('click', handleDialChange);
            submitBtn.addEventListener('click', handleSubmitGuess);
            resetBtn.addEventListener('click', resetGame);
            document.addEventListener('keydown', handleKeyPress); // Add keyboard listener

            // --- Initial Game Setup ---
            createDials();
            resetGame();
        });
    </script>
</body>
</html>